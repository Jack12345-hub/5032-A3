import{_ as V,c as O,r as w,a as c,b as v,d as s,w as h,e as g,v as _,t as n,f as U,n as j,g as A,h as D,o as p}from"./index-BphVWUqO.js";const I={class:"sg-wrap","aria-labelledby":"sg-title"},$={class:"row"},z={class:"field"},J={key:0,class:"err"},q={class:"field"},G={key:0,class:"err"},K={class:"field"},L={class:"field"},P={key:0,class:"muted"},R={key:1,class:"err"},H={class:"endpoint pill",role:"note","aria-live":"polite"},Q={class:"actions"},W=["disabled"],X={key:0,class:"spinner","aria-hidden":"true"},Y={__name:"SendgridForm",props:{endpoint:{type:String,default:""}},setup(C){const E=C,S=O(()=>E.endpoint||"https://sendfeedbackemail-6xpkrvy32a-km.a.run.app"),a=w({name:"",email:"",message:"",files:[]}),y=c([]),d=c(!1),o=c(""),r=c(!1),u=c(!1),m=c(""),l=w({name:"",email:"",files:""});function x(){a.name="",a.email="",a.message="",a.files=[],y.value=[],d.value=!1,o.value="",r.value=!1,u.value=!1,m.value="",Object.keys(l).forEach(t=>l[t]="")}function B(t){const e=Array.from(t.target.files||[]);a.files=e.slice(0,2),y.value=a.files}function T(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t||"")}function N(){let t=!0;return l.name="",l.email="",l.files="",(!a.name||a.name.trim().length<2)&&(l.name="Name too short.",t=!1),T(a.email)||(l.email="Invalid email address.",t=!1),a.files.some(e=>e.size>5*1024*1024)&&(l.files="Each file must be ≤ 5MB.",t=!1),t}async function F(t){const e=await t.arrayBuffer();let i="";const f=new Uint8Array(e),k=32768;for(let b=0;b<f.length;b+=k)i+=String.fromCharCode.apply(null,f.subarray(b,b+k));return btoa(i)}async function M(){if(!S.value){u.value=!0,r.value=!1,o.value='Missing endpoint. Set prop "endpoint" or VITE_SENDFEEDBACK_URL.';return}if(N())try{d.value=!0,u.value=!1,r.value=!1,o.value="Sending…",m.value="";const t=[];for(const f of a.files.slice(0,2))t.push({filename:f.name,mimeType:f.type||"application/octet-stream",contentBase64:await F(f)});const e=await fetch(S.value,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a.name.trim(),email:a.email.trim(),message:a.message||"",attachments:t})}),i=await e.json().catch(()=>({}));if(!e.ok){u.value=!0,r.value=!1,o.value="Failed to send.",m.value=JSON.stringify(i,null,2);return}r.value=!0,u.value=!1,o.value="Sent successfully!",m.value=JSON.stringify(i,null,2)}catch(t){u.value=!0,r.value=!1,o.value=`Error: ${t?.message||t}`}finally{d.value=!1}}return(t,e)=>(p(),v("section",I,[e[8]||(e[8]=s("h2",{id:"sg-title"},"Contact / SendGrid Test",-1)),e[9]||(e[9]=s("p",{class:"sub"},"Fill the form and send via Firebase Cloud Functions + SendGrid.",-1)),s("form",{onSubmit:D(M,["prevent"]),novalidate:""},[s("div",$,[s("div",z,[e[3]||(e[3]=s("label",{for:"sg-name"},"Name",-1)),h(s("input",{id:"sg-name","onUpdate:modelValue":e[0]||(e[0]=i=>a.name=i),autocomplete:"name",required:""},null,512),[[_,a.name,void 0,{trim:!0}]]),l.name?(p(),v("small",J,n(l.name),1)):g("",!0)]),s("div",q,[e[4]||(e[4]=s("label",{for:"sg-email"},"Email",-1)),h(s("input",{id:"sg-email","onUpdate:modelValue":e[1]||(e[1]=i=>a.email=i),type:"email",autocomplete:"email",required:""},null,512),[[_,a.email,void 0,{trim:!0}]]),l.email?(p(),v("small",G,n(l.email),1)):g("",!0)])]),s("div",K,[e[5]||(e[5]=s("label",{for:"sg-message"},"Message",-1)),h(s("textarea",{id:"sg-message","onUpdate:modelValue":e[2]||(e[2]=i=>a.message=i),rows:"5",placeholder:"Say something…"},null,512),[[_,a.message]])]),s("div",L,[e[6]||(e[6]=s("label",{for:"sg-files"},"Attachments (optional, max 2 files, ≤ 5MB each)",-1)),s("input",{id:"sg-files",type:"file",multiple:"",onChange:B},null,32),y.value.length?(p(),v("small",P,n(y.value.map(i=>`${i.name} (${Math.round(i.size/1024)} KB)`).join(" · ")),1)):g("",!0),l.files?(p(),v("small",R,n(l.files),1)):g("",!0)]),s("div",H,[e[7]||(e[7]=s("strong",null,"Endpoint",-1)),s("small",null,n(S.value),1)]),s("div",Q,[s("button",{class:"btn",type:"submit",disabled:d.value},[d.value?(p(),v("span",X)):g("",!0),U(" "+n(d.value?"Sending…":"Send"),1)],8,W),s("button",{class:"ghost",type:"button",onClick:x},"Clear"),s("span",{class:j(["muted",{ok:r.value,err:u.value}])},n(o.value),3)]),h(s("pre",{class:"log","aria-live":"polite"},n(m.value),513),[[A,m.value]])],32)]))}},ee=V(Y,[["__scopeId","data-v-6dc6648e"]]);export{ee as default};
